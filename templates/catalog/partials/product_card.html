{% load static %}

<div class="product-card card h-100 position-relative">
    <!-- Badges -->
    {% if product.is_featured %}
    <span class="product-badge badge bg-success">Featured</span>
    {% endif %}
    
    <!-- Quick Actions -->
    <div class="product-actions">
        <button class="btn" title="Add to Wishlist" onclick="addToWishlist({{ product.get_default_variant.id|default:0 }})">
            <i class="bi bi-heart"></i>
        </button>
        <button class="btn" title="Quick View" data-bs-toggle="modal" data-bs-target="#quickView{{ product.id }}">
            <i class="bi bi-eye"></i>
        </button>
    </div>
    
    <!-- Product Image -->
    <a href="{{ product.get_absolute_url }}">
        {% with image=product.get_primary_image %}
        {% if image %}
        <img src="{{ image.image.url }}" class="card-img-top" alt="{{ image.alt_text|default:product.name }}">
        {% else %}
        <img src="https://via.placeholder.com/300x200?text={{ product.name|urlencode }}" class="card-img-top" alt="{{ product.name }}">
        {% endif %}
        {% endwith %}
    </a>
    
    <div class="card-body">
        <!-- Brand -->
        {% if product.brand %}
        <small class="text-muted d-block mb-1">{{ product.brand.name }}</small>
        {% endif %}
        
        <!-- Product Title -->
        <h6 class="product-title mb-2">
            <a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark">
                {{ product.name }}
            </a>
        </h6>
        
        <!-- Rating -->
        {% if product.average_rating %}
        <div class="rating mb-2">
            {% for i in "12345" %}
                {% if forloop.counter <= product.average_rating %}
                <i class="bi bi-star-fill"></i>
                {% else %}
                <i class="bi bi-star"></i>
                {% endif %}
            {% endfor %}
            <small class="text-muted ms-1">({{ product.review_count }})</small>
        </div>
        {% endif %}
        
        <!-- Price -->
        {% with variant=product.get_default_variant %}
        {% if variant and variant.price %}
        <div class="d-flex align-items-center gap-2 mb-3">
            <span class="product-price">৳{{ variant.price.effective_price|floatformat:0 }}</span>
            {% if variant.price.is_on_sale %}
            <span class="product-price-old">৳{{ variant.price.list_price|floatformat:0 }}</span>
            <span class="badge bg-danger">-{{ variant.price.discount_percent }}%</span>
            {% endif %}
        </div>
        {% else %}
        <div class="mb-3">
            <span class="text-muted">Price not available</span>
        </div>
        {% endif %}
        {% endwith %}
        
        <!-- Stock Status & Add to Cart -->
        {% with variant=product.get_default_variant %}
        {% if variant %}
            {% if variant.is_in_stock %}
            <button class="btn btn-primary w-100" onclick="addToCart({{ variant.id }})">
                <i class="bi bi-cart-plus me-2"></i>Add to Cart
            </button>
            {% else %}
            <button class="btn btn-secondary w-100" disabled>
                <i class="bi bi-x-circle me-2"></i>Out of Stock
            </button>
            {% endif %}
        {% else %}
        <a href="{{ product.get_absolute_url }}" class="btn btn-outline-primary w-100">
            <i class="bi bi-eye me-2"></i>View Details
        </a>
        {% endif %}
        {% endwith %}
    </div>
</div>
